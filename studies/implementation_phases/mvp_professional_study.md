<!-- @Study:ST-013 -->
<!-- @Study:ST-011 -->
<!-- @Study:ST-007 -->
# @Study:ST-019
# دراسة احترافية للمرحلة الأولى: منتج الحد الأدنى القابل للتطبيق (MVP)
## Professional Study for Phase 1: Minimum Viable Product (MVP)

**المؤلف:** Manus AI (كبير المهندسين)
**التاريخ:** 2 نوفمبر 2025
**الهدف:** التحقق من الجدوى التقنية (Technical Feasibility) وإثبات المفهوم (Proof of Concept) لنموذج الذكاء الاصطناعي الأساسي، وتأكيد قدرته على تلبية المتطلب الحاسم للمشروع: **الحفاظ الكامل والدقيق (100%) على تفاصيل قطعة الملابس الأصلية** في كل من خيار **الموديل الخفي** و**الموديل البشري المولد بالذكاء الاصطناعي**.

---

## 1. الجانب التقني (Core Technology Stack & AI Model)

### أ. الواجهة الخلفية (Backend) وإدارة المهام (Task Queue)

تم تأكيد التوصية التقنية باستخدام **Python مع FastAPI** كواجهة خلفية، ودمج **Celery مع Redis** لإدارة المهام.

#### تحليل أداء Python/FastAPI لمعالجة الذكاء الاصطناعي الثقيلة

| المكون | التوصية | تحليل الأداء والجدوى |
| :--- | :--- | :--- |
| **الواجهة الخلفية** | **Python/FastAPI** | **الجدوى التقنية مؤكدة:** FastAPI هو الخيار الأمثل لخدمة استدعاءات الـ API الخاصة بالذكاء الاصطناعي. يعتمد على **ASGI** (Asynchronous Server Gateway Interface) مما يجعله قادراً على التعامل مع عدد كبير من الطلبات المتزامنة (High Concurrency) بكفاءة عالية، وهو أمر حاسم في بيئة تتطلب معالجة صور ثقيلة. كما أن بيئة Python هي البيئة الأم لمكتبات الذكاء الاصطناعي (PyTorch, Hugging Face). |
| **إدارة المهام** | **Celery مع Redis** | **الجدوى التقنية مؤكدة:** معالجة الصور بالذكاء الاصطناعي هي عملية **مكثفة للحوسبة (Compute-Intensive)** وتستغرق وقتاً طويلاً (قد يصل إلى عدة ثوانٍ أو دقيقة). لضمان تجربة مستخدم سلسة وعدم توقف واجهة المستخدم (UI Blocking)، يجب أن تكون المعالجة **غير متزامنة (Asynchronous)**. **Celery** هو المعيار الصناعي لإدارة قوائم الانتظار في Python، و**Redis** يعمل كوسيط رسائل (Message Broker) سريع جداً. |
| **آلية العمل في MVP** | **نموذج غير متزامن (Async Model)** | عندما يرسل المستخدم طلب معالجة، يقوم FastAPI باستقبال الطلب وإرساله فوراً إلى Celery. Celery يقوم بتشغيل مهمة المعالجة على عامل (Worker) منفصل. يتم إرجاع **معرف المهمة (Task ID)** للمستخدم، والذي يمكن استخدامه لاحقاً للاستعلام عن حالة المهمة واستلام الصورة النهائية. |

### ب. نموذج الذكاء الاصطناعي (AI Model) ومنهجية Model Chaining

لتحقيق الشرط الحاسم (100% دقة للمنتج)، يجب أن تتحول الاستراتيجية إلى **الارتداء الافتراضي عالي الدقة (High-Fidelity VTON)** عبر سلسلة نماذج دقيقة.

| الخطوة | المكون التقني | الوظيفة في MVP | الضمان التقني لـ 100% دقة |
| :--- | :--- | :--- | :--- |
| **1. استخلاص الميزات** | **SAM / CLIP** | عزل قطعة الملابس عن الخلفية واستخلاص الميزات الدقيقة (النقش، اللون، النسيج). | يضمن أن النموذج الأساسي يتلقى بيانات نظيفة ومحددة بدقة عن المنتج. |
| **2. توليد الموديل (البشري/الخفي)** | **Diffusion Model (Fine-Tuned)** | توليد صورة الموديل (البشري أو الخفي) بناءً على خصائص المستخدم والوضعية المختارة. | يضمن الواقعية البشرية (Human Fidelity) في حالة الموديل البشري. |
| **3. التحكم بالهيكل** | **ControlNet (Pose/Depth)** | استخلاص خرائط التحكم (الوضعية والعمق) من الموديل المُولّد في الخطوة 2. | يضمن أن قطعة الملابس سيتم وضعها بشكل صحيح وواقعي على هيكل الموديل. |
| **4. دمج المنتج (القلب النابض)** | **Fine-Tuned SDXL + IP-Adapter + IGR** | دمج قطعة الملابس على الموديل باستخدام: **IP-Adapter** للحفاظ على الميزات منخفضة المستوى (النسيج) و **IGR (أو ما يعادلها)** للحفاظ على الميزات عالية المستوى (النقوش والتفاصيل الدقيقة). | **الضمان الحاسم:** استخدام IGR/GarmNet يمثل خط الدفاع الأخير لضمان أن عملية "الإلباس" لا تشوه المنتج الأصلي. |

### ج. قواعد البيانات (Database)

تم تأكيد التوصية باستخدام **PostgreSQL** لمتطلبات الـ MVP، مع التركيز على المرونة لدعم نموذج BYOK لاحقاً.

#### الهيكلية الأولية لقاعدة البيانات (MVP PostgreSQL Schema)

| الجدول | الغرض | الأعمدة الرئيسية المقترحة | ملاحظات |
| :--- | :--- | :--- | :--- |
| `users` | إدارة حسابات المستخدمين الأساسية. | `id`, `email`, `password_hash`, `created_at`, `is_active` | أساس نظام SaaS. |
| `jobs` | تتبع مهام معالجة الصور غير المتزامنة. | `id`, `user_id`, `status` (pending, processing, completed, failed), `celery_task_id`, `input_url`, `output_url`, `model_type` (human/ghost) | حاسم لعملية Celery/Redis. |
| `models` | مكتبة الوضعيات والخلفيات المحدودة في MVP. | `id`, `type` (pose/background), `image_url`, `metadata` (JSONB) | `metadata` لتخزين خصائص الموديل البشري (الجنس، العرق) في حال اختياره. |

---

## 2. مقاييس النجاح الحاسم (Critical Success Metrics)

### أ. المقياس الحاسم (The 100% Fidelity Metric)

المقياس الحاسم لنجاح الـ MVP هو **التحقق البصري والكمي** من أن النموذج يحافظ على تفاصيل المنتج بنسبة 100%.

| نوع المقياس | التفاصيل | معيار النجاح في MVP |
| :--- | :--- | :--- |
| **الدقة البصرية (Visual Fidelity)** | تقييم بشري (Human Evaluation) من قبل فريق داخلي متخصص. | يجب أن يوافق 95% من المقيمين على أن الصورة المُولّدة لا يمكن تمييزها عن الصورة الأصلية من حيث تفاصيل القماش واللون والنمش. |
| **الدقة الكمية (Quantitative Fidelity)** | استخدام مقاييس كمية مثل **LPIPS** (Learned Perceptual Image Patch Similarity) أو **SSIM** (Structural Similarity Index Measure) للمقارنة بين قطعة الملابس الأصلية والقطعة المُولّدة. | يجب أن تحقق النتائج قيماً تقع ضمن النطاق المقبول عالمياً لـ "الارتداء الافتراضي عالي الدقة" (High-Fidelity VTON). |

### ب. إطار عمل إنشاء "مجموعة الاختبار الداخلية" (Internal Test Set Framework)

لضمان أن اختبار الـ 100% دقة شامل وعادل، يجب بناء مجموعة اختبار داخلية (Test Set) وفقاً للمنهجية التالية:

1.  **تحديد فئات التحدي (Challenge Categories):**
    *   **النقوش المعقدة:** صور لملابس ذات نقوش صغيرة، خطوط دقيقة، أو أشكال هندسية متداخلة.
    *   **الأنسجة الصعبة:** صور لأقمشة ذات ملمس واضح (مثل الصوف، المخمل، الدانتيل) أو أقمشة عاكسة (مثل الحرير والساتان).
    *   **الألوان الحساسة:** صور لملابس ذات تدرجات لونية دقيقة أو ألوان نيون يصعب على نماذج الذكاء الاصطناعي الحفاظ عليها.
2.  **جمع البيانات (Data Collection):** جمع 50-100 زوج من الصور (صورة المنتج الأصلية + صورة الموديل المرجعية) تغطي فئات التحدي المذكورة.
3.  **التوليد والتقييم:**
    *   تشغيل كل زوج من الصور عبر سلسلة النماذج (Model Chaining) المقترحة.
    *   إجراء التقييم البصري والكمي (LPIPS/SSIM) على النتائج.
4.  **التحسين التكراري (Iterative Refinement):** إذا فشل النموذج في تحقيق معيار الـ 95% البصري أو المعيار الكمي، يتم إعادة تدريب (Fine-Tuning) النموذج الأساسي (SDXL) وتعديل معاملات ControlNet/IP-Adapter حتى يتم النجاح. **الـ MVP لا يتم إطلاقه قبل النجاح في هذا الاختبار.**

---

## 3. تحليل وإدارة المخاطر (Risk Management Focus)

تم تحديث تحليل المخاطر ليتضمن التحدي المزدوج الجديد:

| التحدي التقني | خطورة التحدي | خطة التغلب المقترحة في مرحلة MVP |
| :--- | :--- | :--- |
| **1. دقة الحفاظ على تفاصيل المنتج 100% (Fidelity)** | **عالية جداً (Critical)** | **الاستثمار في البحث والتطوير (R&D) والتخصيص:** تخصيص المرحلة الأولى (MVP) بالكامل لـ **Fine-Tuning** النموذج الأساسي (SDXL) ودمج المنهجيات المتقدمة (IGR/GarmNet) لضمان أن النقوش والأنسجة لا تتشوه أبداً. **التركيز على نجاح الـ Internal Test Set هو خطة التغلب الرئيسية.** |
| **2. سرعة المعالجة (Processing Speed)** | **متوسطة إلى عالية** | **استخدام Celery/Redis:** تطبيق نظام قائمة انتظار غير متزامن (Asynchronous Queue) لضمان أن المستخدم لا ينتظر أكثر من ثوانٍ قليلة قبل أن يتم إخباره بأن مهمته قيد المعالجة. **تحسين الأجهزة:** استخدام وحدات معالجة رسومية (GPUs) متخصصة ومُحسّنة لعمليات الاستدلال (Inference) في مرحلة الـ MVP. |
| **3. تكاليف التشغيل والـ API (API & Operational Costs)** | **عالية جداً (Critical)** | **الاعتماد على المصادر المفتوحة:** تقليل الاعتماد على واجهات الـ API التجارية الباهظة الثمن (مثل توليد الصور) والاعتماد بدلاً من ذلك على نماذج مفتوحة المصدر مُحسّنة ومُشغلة على خوادمنا الخاصة. هذا يقلل من تكلفة الـ MVP بشكل كبير ويجهز البنية التحتية لتطبيق استراتيجية **BYOK** لاحقاً. |

---

## المراجع (References)

[1] IGR: Improving Diffusion Model for Garment Restoration from Person Image. *arXiv:2412.11513v1* (2024). [URL: https://arxiv.org/html/2412.11513v1]
[2] Python FastAPI vs Flask: A Detailed Comparison. *Turing.com* (2022). [URL: https://www.turing.com/kb/fastapi-vs-flask-a-detailed-comparison]
[3] Creating a Distributed Task Queue in Python with Celery, Redis, and FastAPI. *Medium* (Unknown). [URL: https://medium.com/@alizadehmohamadreza641/an-async-job-queue-for-python-7323912b93a0]
